(()=>{"use strict";let e=!1,t=null,n=[],o=null;function l(n){if(e&&o){const e=document.elementFromPoint(n.clientX,n.clientY);e&&e!==t&&function(e){if(t=e,o){const t=e.getBoundingClientRect();o.style.left=`${t.left}px`,o.style.top=`${t.top}px`,o.style.width=`${t.width}px`,o.style.height=`${t.height}px`}}(e)}}function s(t){if(e){t.preventDefault(),t.stopPropagation();const e=t.target;if(e){n.push(e);let t=function(e){const t=e.getBoundingClientRect();let n=e.parentElement;for(;n;){const e=n.getBoundingClientRect();if(e.width>1.5*t.width&&e.height>1.5*t.height){const e=n.querySelector('input[type="text"]'),t=n.querySelector(".messages, .chat-messages");if(e&&t)return n}n=n.parentElement}return null}(e)||function(e){let t=e;for(;t&&t!==document.body;){const e=!!t.querySelector('input[type="text"]'),n=!!t.querySelector(".messages, .chat-messages"),o=!!t.querySelector('button[type="submit"], .send-button');if(e&&n&&o)return t;t=t.parentElement}return null}(e)||function(e){let t=e;for(;t&&t!==document.body;){const e=(t.className+" "+t.id).toLowerCase();if(e.includes("chat")||e.includes("bot")||e.includes("message")){const e=!!t.querySelector('input[type="text"]'),n=!!t.querySelector(".messages, .chat-messages");if(e&&n)return t}t=t.parentElement}return null}(e);t?u(t):n.length>=3?(t=function(){if(n.length<2)return null;let e=n[0];for(let t=1;t<n.length;t++)e=r(e,n[t]);return e}(),t?u(t):i("Couldn't identify chatbot element. Please try clicking on different parts of the chatbot.")):i(`Element selected. Please click on ${3-n.length} more part(s) of the chatbot.`)}}}function i(e){const t=document.createElement("div");t.style.position="fixed",t.style.top="10px",t.style.left="50%",t.style.transform="translateX(-50%)",t.style.backgroundColor="rgba(0, 0, 0, 0.7)",t.style.color="white",t.style.padding="10px",t.style.borderRadius="5px",t.style.zIndex="10000",t.textContent=e,document.body.appendChild(t),setTimeout((()=>{document.body.removeChild(t)}),3e3)}function r(e,t){const n=c(e),o=c(t);for(const e of n)if(o.includes(e))return e;return document.body}function c(e){const t=[];let n=e;for(;n&&n!==document.body;)t.push(n),n=n.parentElement;return t}function u(r){const c=r.outerHTML;console.log(r),function(e){const t=e.getBoundingClientRect(),n=document.createElement("div");n.style.position="fixed",n.style.pointerEvents="none",n.style.zIndex="10000",n.style.left=`${t.left}px`,n.style.top=`${t.top}px`,n.style.width=`${t.width}px`,n.style.height=`${t.height}px`,n.style.backgroundColor="rgba(0, 255, 0, 0.5)",n.style.transition="opacity 0.5s ease-in-out",n.style.opacity="1",document.body.appendChild(n),setTimeout((()=>{n.style.opacity="0",setTimeout((()=>{document.body.removeChild(n)}),500)}),500)}(r),chrome.runtime.sendMessage({action:"storeHTML",html:c},(()=>{i("Chatbot element identified and HTML stored!")})),e=!1,document.body.style.removeProperty("cursor"),document.removeEventListener("mousemove",l),document.removeEventListener("click",s),o&&(document.body.removeChild(o),o=null),t=null,n=[]}chrome.runtime.onMessage.addListener(((t,n,r)=>{"startSelection"===t.action&&(e=!0,o=document.createElement("div"),o.style.position="fixed",o.style.pointerEvents="none",o.style.zIndex="9999",o.style.border="2px solid red",o.style.backgroundColor="rgba(0, 0, 0, 0.3)",document.body.appendChild(o),document.body.style.setProperty("cursor","crosshair","important"),document.addEventListener("mousemove",l),document.addEventListener("click",s),i("Click on a part of the chatbot. You may need to click multiple times to identify the entire chatbot."))}))})();